-- Léo Hub Ultimate v3 - Mod Menu Final para Roblox Delta
-- Serviços
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- Menu Config
local MenuEnabled = false
local MenuPosition = Vector2.new(100,100)
local MenuSize = Vector2.new(270,380)

-- Funções do menu
local Functions = {
    Aimbot = false,
    ESP = false,
    Crosshair = true,
    PullEnemies = false
}
local AimbotFOV = 50

-- Debounce de clique
local CanClick = true

-- Menu Box
local MenuBox = Drawing.new("Square")
MenuBox.Position = MenuPosition
MenuBox.Size = MenuSize
MenuBox.Filled = true
MenuBox.Color = Color3.fromRGB(25,25,25)
MenuBox.Transparency = 1
MenuBox.Visible = MenuEnabled

-- Menu Title
local Title = Drawing.new("Text")
Title.Text = "Léo Hub Ultimate v3"
Title.Position = MenuPosition + Vector2.new(10,10)
Title.Size = 22
Title.Color = Color3.fromRGB(0,255,255)
Title.Center = false
Title.Visible = MenuEnabled

-- Close Button X
local Close1 = Drawing.new("Line")
local Close2 = Drawing.new("Line")
local CloseOffset = Vector2.new(MenuSize.X-25,15)
Close1.Color = Color3.fromRGB(255,0,0)
Close2.Color = Color3.fromRGB(255,0,0)
Close1.Thickness = 2
Close2.Thickness = 2
Close1.Visible = MenuEnabled
Close2.Visible = MenuEnabled

-- Bolinha para abrir o menu
local MenuButton = Drawing.new("Circle")
MenuButton.Position = Vector2.new(50,50)
MenuButton.Radius = 18
MenuButton.Filled = true
MenuButton.Color = Color3.fromRGB(0,255,255)
MenuButton.Visible = true

-- Crosshair
local Crosshair = Drawing.new("Circle")
Crosshair.Color = Color3.fromRGB(0,255,0)
Crosshair.Radius = 6
Crosshair.Thickness = 2
Crosshair.Filled = false
Crosshair.Visible = true

-- ESP Lines
local ESPLines = {}
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        local line = Drawing.new("Line")
        line.Color = Color3.fromRGB(255,0,0)
        line.Thickness = 2
        line.Transparency = 1
        line.Visible = false
        ESPLines[player] = line
    end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then
        local line = Drawing.new("Line")
        line.Color = Color3.fromRGB(255,0,0)
        line.Thickness = 2
        line.Transparency = 1
        line.Visible = false
        ESPLines[player] = line
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if ESPLines[player] then
        ESPLines[player]:Remove()
        ESPLines[player] = nil
    end
end)

-- Função para inimigo mais próximo
local function getClosestEnemy()
    local closestPlayer = nil
    local shortestDistance = AimbotFOV
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local screenPos, onScreen = Camera:WorldToScreenPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                local distance = (Vector2.new(Mouse.X,Mouse.Y)-Vector2.new(screenPos.X,screenPos.Y)).magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end
    return closestPlayer
end

-- Função PullEnemies
local function PullEnemiesInFront(distance)
    distance = distance or 10
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local frontPos = char.HumanoidRootPart.Position + (char.HumanoidRootPart.CFrame.LookVector*distance)
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            player.Character.HumanoidRootPart.CFrame = CFrame.new(frontPos)
        end
    end
end

-- Controle de clique
local mouseDown = false
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        mouseDown = true
    end
end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        mouseDown = false
    end
end)

-- Loop principal
RunService.RenderStepped:Connect(function()
    local mousePos = Vector2.new(Mouse.X,Mouse.Y)

    -- Bolinha abrir menu
    if mouseDown and CanClick and (MenuButton.Position - mousePos).magnitude <= MenuButton.Radius then
        MenuEnabled = not MenuEnabled
        MenuBox.Visible = MenuEnabled
        Title.Visible = MenuEnabled
        Close1.Visible = MenuEnabled
        Close2.Visible = MenuEnabled
        CanClick = false
        task.delay(0.2,function() CanClick = true end)
    end

    -- X de fechar
    Close1.From = MenuPosition + CloseOffset
    Close1.To = Close1.From + Vector2.new(12,12)
    Close2.From = Close1.From + Vector2.new(0,12)
    Close2.To = Close1.From + Vector2.new(12,0)

    if MenuEnabled and mouseDown and CanClick then
        local centerX = Close1.From + Vector2.new(6,6)
        if (centerX - mousePos).magnitude <= 12 then
            MenuEnabled = false
            MenuBox.Visible = false
            Title.Visible = false
            Close1.Visible = false
            Close2.Visible = false
            CanClick = false
            task.delay(0.2,function() CanClick = true end)
        end
    end

    -- Crosshair
    Crosshair.Visible = Functions.Crosshair
    Crosshair.Position = Vector2.new(Mouse.X,Mouse.Y)

    -- Aimbot
    if Functions.Aimbot and mouseDown then
        local target = getClosestEnemy()
        if target then
            local targetPos = target.Character.HumanoidRootPart.Position
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position,targetPos),0.3)
        end
    end

    -- ESP
    if Functions.ESP then
        for player,line in pairs(ESPLines) do
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local pos = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
                line.From = Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y)
                line.To = Vector2.new(pos.X,pos.Y)
                line.Visible = true
            else
                line.Visible = false
            end
        end
    else
        for _,line in pairs(ESPLines) do line.Visible=false end
    end

    -- PullEnemies
    if Functions.PullEnemies then
        PullEnemiesInFront(15)
    end

    -- Toggles no menu
    if MenuEnabled and mouseDown and CanClick then
        local startY = 50
        for name,state in pairs(Functions) do
            local togglePos = MenuPosition + Vector2.new(20,startY)
            if (togglePos - mousePos).magnitude <= 50 then
                Functions[name] = not state
                CanClick = false
                task.delay(0.2,function() CanClick = true end)
            end
            startY = startY + 30
        end
    end
end)
